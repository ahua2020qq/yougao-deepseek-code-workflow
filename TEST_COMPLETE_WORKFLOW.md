# 完整工作流测试指南

## 测试目标
验证插件从命令触发到文件自动生成的完整工作流

## 测试步骤

### 步骤1：启动扩展开发主机
1. 按 **F5** 启动扩展开发主机
2. 等待新窗口打开（扩展开发宿主）

### 步骤2：在新窗口中测试插件
1. 在新窗口中按 **Ctrl+Shift+P**
2. 输入 **"油糕出品"**
3. 选择 **"油糕出品 | 运行DeepSeek Code Agent"**

### 步骤3：输入测试任务
在输入框中输入：
```
新建一个calc.js文件，写入一个实现两数相加的函数，带注释说明
```

### 步骤4：观察执行结果
预期结果：

#### 1. API调用成功
- 显示"正在运行Code Agent..."提示
- 成功调用火山引擎DeepSeek API

#### 2. AI响应处理
- 输出面板显示AI的思考过程
- AI正确选择`write_file`工具
- 生成正确的文件路径和内容

#### 3. 工具自动执行
- 自动创建`calc.js`文件
- 文件内容包含完整的加法函数
- 显示"文件创建成功"消息
- 自动在编辑器中打开文件

#### 4. 输出面板显示
```
=== Code Agent执行结果 ===
我来为您创建一个 `calc.js` 文件...

=== 工具调用执行 ===

执行工具: write_file
参数: {
  "path": "calc.js",
  "content": "...完整代码..."
}

✅ 文件创建成功: [完整路径]/calc.js
文件大小: [数字] 字符
```

## 验证点

### ✅ 验证点1：文件创建
- 检查工作区根目录是否有`calc.js`文件
- 文件内容是否正确完整

### ✅ 验证点2：编辑器打开
- 文件是否自动在编辑器中打开
- 是否可以正常编辑和保存

### ✅ 验证点3：输出信息
- 输出面板是否有完整的执行日志
- 是否有错误信息显示

### ✅ 验证点4：用户反馈
- 是否有"文件创建成功"的提示消息
- 是否有"Code Agent执行完成"的提示

## 故障排除

### 问题1：文件未创建
**可能原因**：
1. 工作区未打开
2. 文件路径权限问题
3. 工具执行逻辑错误

**解决方案**：
1. 确保在新窗口中打开了工作区
2. 检查输出面板的错误信息
3. 查看调试控制台日志

### 问题2：API调用失败
**可能原因**：
1. API Key配置错误
2. 网络连接问题
3. 火山引擎服务问题

**解决方案**：
1. 检查`.vscode/settings.json`配置
2. 运行`node test_direct_api.js`测试API连接
3. 查看调试控制台中的API错误

### 问题3：工具执行错误
**可能原因**：
1. Tools参数解析错误
2. 文件系统权限问题
3. 代码逻辑错误

**解决方案**：
1. 检查输出面板中的工具参数
2. 查看`ToolExecutor`类的执行日志
3. 检查文件路径是否正确

## 成功标准

### 核心成功标准
1. ✅ 命令可访问：Ctrl+Shift+P能找到命令
2. ✅ API调用成功：成功调用DeepSeek API
3. ✅ AI响应正确：生成正确的工具调用参数
4. ✅ 工具自动执行：自动创建文件并打开
5. ✅ 用户反馈：显示成功消息和提示

### 扩展成功标准
1. ✅ 完整的错误处理
2. ✅ 详细的执行日志
3. ✅ 良好的用户体验
4. ✅ 可扩展的工具框架

## 测试记录

### 预期测试结果
- 输入任务后，插件应自动创建`calc.js`文件
- 文件内容应包含完整的加法函数实现
- 文件应自动在编辑器中打开
- 输出面板应显示完整的执行过程

### 实际测试结果
[在此记录实际测试结果]

## 结论

如果所有验证点都通过，说明：
1. ✅ 插件核心链路完全通畅
2. ✅ 工具自动执行功能正常工作
3. ✅ 插件已达到生产可用状态
4. ✅ 用户可以享受完整的AI编程助手体验